/*! FlexySlider 2014-08-20 */
angular.module("FlexySlider",[]).provider("config",function(){var a={metrics:[{metric:"months",start:5,end:28,total:88,color:"#f2672c",colorLight:"#fba63c",gradient:"45-#f2672c-#fba63c",verticalShift:30},{metric:"amount",start:51,end:70,total:75,color:"#7db93f",colorLight:"#cdda28",gradient:"135-#7db93f-#cdda28",verticalShift:-20}],labels:{amount:[{id:51,label:"£100",value:100,constraints:{min:6,max:6},sliderLabel:"£100"},{id:52,label:"£200",value:200,constraints:{min:6,max:6},sliderLabel:" "},{id:53,label:"£300",value:300,constraints:{min:6,max:6},sliderLabel:" "},{id:54,label:"£400",value:400,constraints:{min:6,max:6},sliderLabel:" "},{id:55,label:"£500",value:500,constraints:{min:6,max:6},sliderLabel:"£500"},{id:56,label:"£600",value:600,constraints:{min:6,max:6},sliderLabel:" "},{id:57,label:"£700",value:700,constraints:{min:6,max:6},sliderLabel:" "},{id:58,label:"£800",value:800,constraints:{min:6,max:6},sliderLabel:" "},{id:59,label:"£900",value:900,constraints:{min:6,max:6},sliderLabel:" "},{id:60,label:"£1000",value:1e3,constraints:{min:1,max:6},sliderLabel:"£1000"},{id:61,label:"£1100",value:1100,constraints:{min:1,max:6},sliderLabel:" "},{id:62,label:"£1200",value:1200,constraints:{min:1,max:6},sliderLabel:" "},{id:63,label:"£1300",value:1300,constraints:{min:1,max:6},sliderLabel:" "},{id:64,label:"£1400",value:1400,constraints:{min:1,max:6},sliderLabel:" "},{id:65,label:"£1500",value:1500,constraints:{min:1,max:6},sliderLabel:"£1500"},{id:66,label:"£1600",value:1600,constraints:{min:1,max:6},sliderLabel:" "},{id:67,label:"£1700",value:1700,constraints:{min:1,max:6},sliderLabel:" "},{id:68,label:"£1800",value:1800,constraints:{min:1,max:6},sliderLabel:" "},{id:69,label:"£1900",value:1900,constraints:{min:1,max:6},sliderLabel:" "},{id:70,label:"£2000",value:2e3,constraints:{min:1,max:6},sliderLabel:"£2000"}],months:[{id:5,value:24,label:"24 Months",sliderLabel:"24 Months"},{id:6,value:23,label:"23 Months",sliderLabel:" "},{id:7,value:22,label:"22 Months",sliderLabel:" "},{id:8,value:21,label:"21 Months",sliderLabel:"21"},{id:9,value:20,label:"20 Months",sliderLabel:" "},{id:10,value:19,label:"19 Months",sliderLabel:" "},{id:11,value:18,label:"18 Months",sliderLabel:"18"},{id:12,value:17,label:"17 Months",sliderLabel:" "},{id:13,value:16,label:"16 Months",sliderLabel:" "},{id:14,value:15,label:"15 Months",sliderLabel:"15"},{id:15,value:14,label:"14 Months",sliderLabel:" "},{id:16,value:13,label:"13 Months",sliderLabel:" "},{id:17,value:12,label:"12 Months",sliderLabel:"12"},{id:18,value:11,label:"11 Months",sliderLabel:" "},{id:19,value:10,label:"10 Months",sliderLabel:" "},{id:20,value:9,label:"9 Months",sliderLabel:"9"},{id:21,value:8,label:"8 Months",sliderLabel:" "},{id:22,value:7,label:"7 Months",sliderLabel:" "},{id:23,value:6,label:"6 Months",sliderLabel:"6"},{id:24,value:5,label:"5 Months",sliderLabel:" "},{id:25,value:4,label:"4 Months",sliderLabel:" "},{id:26,value:3,label:"3 Months",sliderLabel:"3"},{id:27,value:2,label:"2 Months",sliderLabel:" "},{id:28,value:1,label:"1 Month",sliderLabel:"1 Month"}]}};this.$get=function(){var b=a;return b.labels.getLabelAt=this.getLabelAt,b.labels.getAt=this.getAt,b},this.getLabelAt=function(a,b){for(var c in this[a])if(this[a][c].id==b)return this[a][c].label;return void 0},this.getAt=function(a,b){for(var c in this[a])if(this[a][c].id==b)return this[a][c];return void 0},this.setConfig=function(a){this.config=a}}),angular.module("FlexySlider").directive("sliderWidget",["widgetDrawer","$window",function(a,b){return{restrict:"EA",require:"?ngModel",link:function(c,d,e,f){f&&(c.$on("amount",function(b,e){f.$setViewValue({amount:parseInt(e,10),months:f.$modelValue.months||1}),c.canvas=a(d[0],f.$viewValue,c.canvas)}),c.$on("months",function(b,e){f.$setViewValue({amount:f.$modelValue.amount||300,months:parseInt(e,10)}),c.canvas=a(d[0],f.$viewValue,c.canvas)}),c.$watchCollection("[ amount, months ]",function(){c.canvas=a(d[0],f.$viewValue,c.canvas)}),b.onresize=function(){console.log(arguments),c.canvas=a(d[0],f.$viewValue,c.canvas)})}}}]),angular.module("FlexySlider").factory("angles",function(){return{calculate:function(a,b,c,d){b>c&&(b-=c);var e=360/c*b,f=(90-e)*Math.PI/180,g=a.x+d*Math.cos(f),h=a.y-d*Math.sin(f);return{x:Math.round(g),y:Math.round(h),angle:e}},calculateDistance:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},findPoint:function(a,b,c,d,e,f){f>0?(b.y>d.y&&(b.y=d.y),b.y<c.y&&(b.y=c.y)):(b.y<d.y&&(b.y=d.y),b.y>c.y&&(b.y=c.y));var g={x:0,y:b.y},h=Math.abs(b.y-a.y);return g.x=Math.round(f*Math.sqrt(Math.abs(e*e-h*h))+a.x),g},findAngleBetweenPoints:function(a,b){var c={x:a.x,y:0},d=((b.x-a.x)*(c.x-a.x)+(b.y-a.y)*(c.y-a.y))/(Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))*Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2)));return Math.acos(d)},findClosestPoint:function(a,b,c,d,e,f){var g,h,i=[];for(g=b;c>=g;g++)h=this.calculate(a,g,d,f),i.push({step:g,distance:this.calculateDistance(h,e),point:h});return i.sort(function(a,b){return a.distance-b.distance}),i[0]}}}),angular.module("FlexySlider").factory("arc",function(a){return function(b,c,d,e,f){if(c>d)throw new RangeError("start value must be less or equal to end value.");c==d&&(c-=.02*e,d+=.02*e);var g=a.calculate(b,c,e,f),h=a.calculate(b,d,e,f),i=[["M",g.x,g.y],["A",f,f,0,+(h.angle-g.angle>180),1,h.x,h.y]];return{path:i}}}),angular.module("FlexySlider").factory("illustrator",["config","angles",function(a,b){return{drawHandle:function(a,b,c,d){var e=a.set();return e.push(a.circle(c.x,c.y,30).attr("fill","#ccc").attr("stroke","#ccc"),a.circle(c.x,c.y,26).attr("fill","#bbb").attr("stroke","#bbb"),a.circle(c.x,c.y,14).attr("fill","#aaa").attr("stroke","#aaa"),a.circle(c.x,c.y,10).attr("fill",d).attr("stroke","none")),e},drawCircularLabels:function(a,c,d,e,f){e=e||0,f=f||12;var g=a.set(),h={arc:a.canvas.offsetWidth>550?200:120},i=a.canvas.offsetWidth>550?"18px":"12px";for(var j in d)if(d.hasOwnProperty(j)){var k=d[j].sliderLabel||d[j].label;k.length<3&&(k+="          ");var l=b.calculate(c,d[j].id,f,h.arc);g.push(a.text(l.x+e,l.y,k.replace(/ /g," ")))}return g.attr({font:'"Open Sans", sans-serif',fill:"#999","text-align":"right"}).attr("font-size",i),g},drawCircles:function(a,b){var c=a.set(),d={innerWhite:a.canvas.offsetWidth>550?110:50,innerBlue:a.canvas.offsetWidth>550?105:45};return c.push(a.circle(b.x,b.y,d.innerWhite).attr("fill","#fff").attr("stroke","#fff").glow({color:"#ccc",width:10}),a.circle(b.x,b.y,d.innerBlue).attr("fill","#1d76ba").attr("stroke","#1d76ba")),c},drawCentralLabel:function(a,b,c,d){return this["drawCentralLabel"+a[0].toUpperCase()+a.slice(1)](b,c,d)},drawCentralLabelAmount:function(a,b,c){var d={normal:a.canvas.offsetWidth>550?"24px":"12px",big:a.canvas.offsetWidth>550?"36px":"18px",spacing:a.canvas.offsetWidth>550?40:20},e=a.set();return e.push(a.set(),a.set()),e[0].push(a.text(b.x,b.y-2*d.spacing+d.spacing/2,"Borrow")).attr("opacity",.7),e[1].push(a.text(b.x,b.y-d.spacing+d.spacing/2,c)),e.attr({font:'"Open Sans", sans-serif',fill:"#fff","text-align":"center"}).attr("font-size",d.normal),e[1].attr("font-weight","bold").attr("font-size","30px"),e[1][0].attr("font-size",d.big),e},drawCentralLabelMonths:function(a,b,c){var d={normal:a.canvas.offsetWidth>550?"24px":"12px",big:a.canvas.offsetWidth>550?"30px":"14px",spacing:a.canvas.offsetWidth>550?30:15},e=a.set();return e.push(a.set(),a.set()),e[0].push(a.text(b.x,b.y+d.spacing-d.spacing/2,"for")).attr("opacity",.7),e[1].push(a.text(b.x,b.y+2*d.spacing-d.spacing/2,c)),e.attr({font:'"Open Sans", sans-serif',fill:"#fff","text-align":"center"}).attr("font-size",d.normal),e[1].attr("font-weight","bold"),e[1][0].attr("font-size",d.big),e},drawWidget:function(c,d,e){c.clear();var f,g,h,i={},j=this.drawCircles(c,d),k=c.canvas.offsetWidth>550?161:90,l=1,m=8;for(f in a.metrics)if(a.metrics.hasOwnProperty(f)){h=a.metrics[f].total/2-a.metrics[f].end>=0?1:-1,0>h&&(l+=15,m+=15),j.push(c.path().attr({stroke:"#ddd","stroke-width":48,"stroke-linecap":"round",arc:[d,l,m,24,k]})),j.push(c.path().attr({stroke:"#eee","stroke-width":44,"stroke-linecap":"round",arc:[d,l,m,24,k]}).glow({color:"#666",width:4})),j.push(c.path().attr({stroke:a.metrics[f].color,"stroke-width":44,"stroke-linecap":"round",arc:[d,a.metrics[f].start,a.metrics[f].end,a.metrics[f].total,k]})),j.push(c.path().attr({stroke:a.metrics[f].color,"stroke-width":40,"stroke-linecap":"round","stroke-opacity":0,arc:[d,a.metrics[f].start,a.metrics[f].end,a.metrics[f].total,k]}).glow({color:a.metrics[f].colorLight,width:4}));for(var n in a.labels[a.metrics[f].metric])a.labels[a.metrics[f].metric][n].value==e[a.metrics[f].metric]&&(g=a.labels[a.metrics[f].metric][n].id);g>a.metrics[f].end&&(g=a.metrics[f].end),g<a.metrics[f].start&&(g=a.metrics[f].start),this.drawHandle(c,d,b.calculate(d,g,a.metrics[f].total,k),a.metrics[f].gradient).draggable(d,k,a.metrics[f].start,a.metrics[f].end,a.metrics[f].total,h,a.metrics[f].metric),i[a.metrics[f].metric]=this.drawCentralLabel(a.metrics[f].metric,c,d,a.labels.getLabelAt(a.metrics[f].metric,g)),this.drawCircularLabels(c,d,a.labels[a.metrics[f].metric],a.metrics[f].verticalShift,a.metrics[f].total)}}}}]),angular.module("FlexySlider").factory("widgetDrawer",["illustrator","angles","arc","config","$rootScope",function(a,b,c,d,e){return function(f,g,h){var i=h||new Raphael(f);h||(i.customAttributes.arc=c,i.setSize(f.offsetWidth,f.offsetWidth>500?400:250)),Raphael.st.draggable=function(a,c,f,g,h,j,k){var l=this,m=0,n=0,o={x:0,y:0},p=b.calculate(a,f,h,c),q=b.calculate(a,g,h,c),r=function(d,e){var f=b.findPoint(a,{x:m+d,y:n+e},p,q,c,j);o=f,l.attr({cx:f.x,cy:f.y})},s=function(){m=l[0].attr("cx"),n=l[0].attr("cy")},t=function(){var c,j,m=i.canvas.offsetWidth>550?151:90;for(c in d.metrics)d.metrics[c].metric==k&&(j=b.findClosestPoint(a,f,g,h,o,m),l.attr({cx:j.point.x,cy:j.point.y}),e.$broadcast(k,d.labels.getAt(k,j.step).value))};this.drag(r,s,t)};var j={x:f.offsetWidth/2,y:(f.offsetWidth>500?400:250)/2};return a.drawWidget(i,j,g),i}}]);